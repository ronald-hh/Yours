<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 1: Getting Started</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ffafcc 0%, #ffc8dd 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 40px 20px;
            overflow-y: auto;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(255, 105, 180, 0.3);
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b9d, #ff4081);
            color: white;
            padding: 30px 25px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .progress {
            margin-top: 15px;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .back-btn {
            padding: 10px 20px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-btn:hover {
            background: #5a6268;
        }
        
        .day-indicator {
            font-weight: 600;
            color: #ff4081;
            font-size: 1.1rem;
        }
        
        .db-status {
            background: #e3f2fd;
            border: 2px solid #bbdefb;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 25px;
            color: #1565c0;
            font-weight: 600;
            text-align: center;
            display: none;
        }
        
        .db-status.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .db-status.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .progress-bar {
            height: 10px;
            background: #e0e0e0;
            margin-top: 15px;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #4cd964, #5ac8fa);
            width: 20%;
            transition: width 0.5s ease;
        }
        
        .progress-dots {
            display: flex;
            justify-content: space-between;
            margin-top: -15px;
        }
        
        .dot {
            width: 40px;
            height: 40px;
            background: #e0e0e0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #666;
            z-index: 1;
        }
        
        .dot.active {
            background: #ff4081;
            color: white;
            transform: scale(1.1);
        }
        
        .dot.completed {
            background: #4cd964;
            color: white;
        }
        
        .puzzle-content {
            padding: 40px;
            min-height: 600px;
        }
        
        .puzzle {
            display: none;
            animation: fadeIn 0.5s ease;
            padding: 20px 0;
        }
        
        .puzzle.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .puzzle h2 {
            color: #333;
            font-size: 1.8rem;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        .option {
            padding: 25px 20px;
            background: #f8f9fa;
            border: 3px solid #dee2e6;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
            text-align: center;
        }
        
        .option:hover:not(:disabled) {
            border-color: #ff6b9d;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(255, 107, 157, 0.2);
        }
        
        .option.correct {
            background: #4cd964;
            color: white;
            border-color: #28a745;
        }
        
        .option.wrong {
            background: #ff3b30;
            color: white;
            border-color: #c00;
        }
        
        .option:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        .scramble-letters {
            display: flex;
            justify-content: space-between;
            margin: 50px 0;
            padding: 0 10px;
        }
        
        .scramble-letter {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #ff6b9d, #ff4081);
            color: white;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.3);
            transform: rotate(5deg);
        }
        
        .scramble-letter:nth-child(1) {
            transform: rotate(-15deg);
        }
        
        .scramble-letter:nth-child(2) {
            transform: rotate(10deg);
        }
        
        .scramble-letter:nth-child(3) {
            transform: rotate(-5deg);
        }
        
        .scramble-letter:nth-child(4) {
            transform: rotate(15deg);
        }
        
        .scramble-letter:nth-child(5) {
            transform: rotate(-10deg);
        }
        
        .date-input {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 40px 0;
            align-items: center;
        }
        
        .date-input input {
            padding: 20px;
            border: 3px solid #dee2e6;
            border-radius: 12px;
            font-size: 1.3rem;
            text-align: center;
            width: 250px;
        }
        
        .date-input input::placeholder {
            color: #aaa;
            font-style: italic;
        }
        
        .date-input input:disabled {
            background: #f8f9fa;
        }
        
        .date-input button {
            padding: 20px 40px;
            background: #ff4081;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.3rem;
            cursor: pointer;
            font-weight: 600;
        }
        
        .date-input button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .word-input {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 40px 0;
        }
        
        .word-input input {
            width: 70px;
            height: 70px;
            border: 3px solid #dee2e6;
            border-radius: 12px;
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            text-transform: uppercase;
        }
        
        .word-input input:disabled {
            background: #f8f9fa;
        }
        
        .check-btn {
            padding: 20px 40px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.3rem;
            cursor: pointer;
            font-weight: 600;
            display: block;
            margin: 20px auto;
        }
        
        .check-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .feedback {
            padding: 20px;
            margin: 25px auto;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: 600;
            text-align: center;
            max-width: 600px;
            display: none;
        }
        
        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 3px solid #c3e6cb;
            display: block;
        }
        
        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 3px solid #f5c6cb;
            display: block;
        }
        
        .special-message {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .message-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: scaleIn 0.3s ease;
        }
        
        @keyframes scaleIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .message-box h3 {
            color: #ff4081;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }
        
        .message-box p {
            color: #333;
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .message-box button {
            padding: 15px 40px;
            background: #ff4081;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
        }
        
        .hint-box {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            color: #856404;
            font-style: italic;
            text-align: center;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
            padding: 30px 0;
            border-top: 2px solid #e9ecef;
        }
        
        .nav-btn {
            padding: 18px 35px;
            font-size: 1.2rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .prev-btn {
            background: #6c757d;
            color: white;
        }
        
        .next-btn {
            background: #ff4081;
            color: white;
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .complete-btn {
            padding: 20px 50px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.4rem;
            font-weight: 600;
            cursor: pointer;
            display: none;
            margin: 30px auto;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.4);
            }
            50% {
                box-shadow: 0 0 0 20px rgba(40, 167, 69, 0);
            }
        }
        
        .complete-btn:disabled {
            background: #6c757d;
            animation: none;
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .footer {
            text-align: center;
            padding: 25px;
            background: #f8f9fa;
            color: #666;
            border-top: 2px solid #e9ecef;
        }
        
        .hint {
            color: #888;
            font-style: italic;
            text-align: center;
            margin: 15px 0;
            font-size: 1.1rem;
        }
        
        .save-status {
            text-align: center;
            color: #28a745;
            font-weight: 600;
            margin: 20px 0;
            font-size: 1.1rem;
            min-height: 24px;
        }
        
        .consecutive-counter {
            position: fixed;
            top: 100px;
            right: 20px;
            background: #ff4081;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(255, 64, 129, 0.3);
            display: none;
            z-index: 100;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            flex-direction: column;
            gap: 20px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #ffebee;
            border-top: 5px solid #ff4081;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        .read-only-mode .option,
        .read-only-mode input,
        .read-only-mode textarea,
        .read-only-mode button:not(.back-btn):not(.nav-btn) {
            opacity: 0.8;
            cursor: default !important;
        }
        
        .read-only-mode .option:hover {
            transform: none !important;
            box-shadow: none !important;
            border-color: #dee2e6 !important;
        }
        
        .read-only-mode .container {
            border: 3px solid #28a745;
        }
        
        .completed-badge {
            background: #28a745;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .completed-message {
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
            border: 2px solid #c3e6cb;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            .header {
                padding: 20px 15px;
            }
            .header h1 {
                font-size: 1.8rem;
            }
            .puzzle-content {
                padding: 20px;
            }
            .options {
                grid-template-columns: 1fr;
            }
            .option {
                padding: 20px 15px;
                font-size: 1.1rem;
            }
            .scramble-letters {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }
            .scramble-letter {
                width: 50px;
                height: 50px;
                font-size: 1.8rem;
            }
            .word-input input {
                width: 50px;
                height: 50px;
                font-size: 1.8rem;
            }
            .navigation {
                flex-direction: column;
                gap: 10px;
            }
            .nav-btn {
                width: 100%;
            }
            .consecutive-counter {
                position: static;
                margin: 20px auto;
                width: fit-content;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Database Status -->
        <div id="dbStatus" class="db-status">üîÑ Checking access...</div>

        <!-- Loading State -->
        <div id="loadingDay" class="loading">
            <div class="spinner"></div>
            <p>Loading Day 1...</p>
        </div>

        <!-- Main Content (hidden initially) -->
        <div id="dayContent" style="display: none;">
            <!-- Header -->
            <div class="header">
                <h1>Day 1: Getting Started üòÅ </h1>
                <div class="progress">Question <span id="currentPuzzle">1</span>/5</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-dots">
                    <div class="dot active">1</div>
                    <div class="dot">2</div>
                    <div class="dot">3</div>
                    <div class="dot">4</div>
                    <div class="dot">5</div>
                </div>
            </div>

            <!-- Navigation Bar -->
            <div class="nav-bar">
                <a href="dashboard.html" class="back-btn">‚Üê Back to Dashboard</a>
                <div class="day-indicator">Day 1 of 7</div>
            </div>

            <!-- Puzzle Content -->
            <div class="puzzle-content">
                <!-- Completed Message (only shown in read-only mode) -->
                <div id="completedMessage" class="completed-message" style="display: none;">
                    You've already completed this day! Viewing in read-only mode. Proud of you!
                </div>

                <!-- Consecutive Counter -->
                <div id="consecutiveCounter" class="consecutive-counter">
                    üî• Consecutive Correct: <span id="consecutiveCount">0</span>
                </div>

                <!-- Puzzle 1 -->
                <div id="puzzle1" class="puzzle active">
                    <h2>What's my favorite color? ü§î</h2>
                    <div class="hint-box">
                        üí° Hint: It's not a bright color
                    </div>
                    <div class="options">
                        <button class="option" data-answer="Blue">Blue</button>
                        <button class="option" data-answer="Black">Black</button>
                        <button class="option" data-answer="White">White</button>
                        <button class="option" data-answer="Brown">Brown</button>
                    </div>
                    <div id="feedback1" class="feedback"></div>
                </div>

                <!-- Puzzle 2 -->
                <div id="puzzle2" class="puzzle">
                    <h2>What's my favorite food? üëÄ </h2>
                    <div class="hint-box">
                        üí° Hint: Do I even have that? Mmh ü§î
                    </div>
                    <div class="options">
                        <button class="option" data-answer="I don't have yet">I don't have yet</button>
                        <button class="option" data-answer="Mac & cheese">Mac & cheese</button>
                        <button class="option" data-answer="Pizza">Pizza</button>
                        <button class="option" data-answer="I eat everything">I eat everything</button>
                    </div>
                    <div id="feedback2" class="feedback"></div>
                </div>

                <!-- Puzzle 3 -->
                <div id="puzzle3" class="puzzle">
                    <h2>What's something I do in free time? ü§î</h2>
                    <div class="hint-box">
                        üí° Hint: It keeps me active üòé
                    </div>
                    <div class="options">
                        <button class="option" data-answer="Gaming">Gaming</button>
                        <button class="option" data-answer="Reading">Reading</button>
                        <button class="option" data-answer="Gym">Gym</button>
                        <button class="option" data-answer="Take a walk">Take a walk</button>
                    </div>
                    <div id="feedback3" class="feedback"></div>
                </div>

                <!-- Puzzle 4 -->
                <div id="puzzle4" class="puzzle">
                    <h2>When did we first start talking? ü§î</h2>
                    <div class="hint-box">
                        üí° Hint: Ayaya üòÇüòÇ
                    </div>
                    <div class="date-input">
                        <input type="text" id="dateInput" placeholder="DD-MM-YYYY" maxlength="10">
                        <button id="checkDate">Submit Date</button>
                    </div>
                    <div id="feedback4" class="feedback"></div>
                </div>

                <!-- Puzzle 5 -->
                <div id="puzzle5" class="puzzle">
                    <h2>Unscramble the word!</h2>
                    <div class="hint-box">
                        üí° Hint: You know this!
                    </div>
                    <div class="scramble-letters">
                        <div class="scramble-letter">H</div>
                        <div class="scramble-letter">A</div>
                        <div class="scramble-letter">M</div>
                        <div class="scramble-letter">R</div>
                        <div class="scramble-letter">C</div>
                    </div>
                    <p class="hint">Enter the correct word below:</p>
                    <div class="word-input">
                        <input type="text" class="letter" maxlength="1" aria-label="Letter 1">
                        <input type="text" class="letter" maxlength="1" aria-label="Letter 2">
                        <input type="text" class="letter" maxlength="1" aria-label="Letter 3">
                        <input type="text" class="letter" maxlength="1" aria-label="Letter 4">
                        <input type="text" class="letter" maxlength="1" aria-label="Letter 5">
                    </div>
                    <button id="checkWord" class="check-btn">Check WordüëÄ</button>
                    <div id="feedback5" class="feedback"></div>
                </div>

                <!-- Navigation -->
                <div class="navigation">
                    <button id="prevBtn" class="nav-btn prev-btn" disabled>‚Üê Previous</button>
                    <button id="nextBtn" class="nav-btn next-btn">Next Question ‚Üí</button>
                </div>

                <!-- Save Status -->
                <div id="saveStatus" class="save-status"></div>

                <!-- Complete Button -->
                <button id="completeBtn" class="complete-btn">Complete Day 1, this was easy right? üòÅ</button>
            </div>

            <!-- Footer -->
            <div class="footer">
                <p>Made by Hlakulo (Your man to be)</p>
            </div>
        </div>
    </div>

    <!-- Special Message Popup -->
    <div id="specialMessage" class="special-message">
        <div class="message-box">
            <h3 id="messageTitle">Special Message! üíï</h3>
            <p id="messageText"></p>
            <button id="closeMessage">Continue</button>
        </div>
    </div>

    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://yqxrsigblsalvhndfvvs.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlxeHJzaWdibHNhbHZobmRmdnZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwNDUwNjQsImV4cCI6MjA4MDYyMTA2NH0.gsj4ya1LMKNtWGdwhaDa91L81AdOc6E1BcBd2gwXcJc';

        // Global variables
        let supabase;
        let currentUser = null;
        let currentDay = 1;
        let isReadOnly = false;

        // Correct answers
        const CORRECT_ANSWERS = {
            1: 'Black',
            2: 'I don\'t have yet',
            3: 'Gym',
            4: '16-08-2025',
            5: 'MARCH'
        };

        // Main initialization - SESSIONSTORAGE ONLY
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Day 1: DOM loaded');

            // SIMPLE AUTHENTICATION CHECK - SESSIONSTORAGE ONLY
            await checkAuthentication();
        });

        // SIMPLIFIED AUTHENTICATION CHECK - SESSIONSTORAGE ONLY
        async function checkAuthentication() {
            console.log('Checking authentication...');

            // Check sessionStorage ONLY (will auto-clear when tab closes)
            const sessionData = sessionStorage.getItem('currentUser');

            if (sessionData) {
                try {
                    currentUser = JSON.parse(sessionData);
                    console.log('Found user in sessionStorage:', currentUser.username);

                    console.log('Authentication successful! User:', currentUser.username);

                    // Initialize Supabase
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

                    // Now check Day 1 access
                    await initializeDay();

                } catch (error) {
                    console.error('Error parsing sessionStorage:', error);
                    redirectToLogin();
                }
            } else {
                // No user found
                console.log('NO USER FOUND - Redirecting to login');
                redirectToLogin();
            }
        }

        function redirectToLogin() {
            showDBStatus('‚ùå Please login first!', 'error');
            setTimeout(() => {
                // Clear session data
                sessionStorage.clear();
                window.location.href = 'index.html';
            }, 1500);
        }

        async function initializeDay() {
            console.log('Initializing Day 1 for user:', currentUser.username);
            showDBStatus('üîê Checking Day 1 access...');

            try {
                // Check if Day 1 progress exists
                const {
                    data: progress,
                    error
                } = await supabase
                    .from('user_progress')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .eq('day_number', currentDay)
                    .single();

                if (error) {
                    // If no progress found, create it
                    if (error.code === 'PGRST116') {
                        console.log('Creating Day 1 progress...');
                        await createDayProgress();
                    } else {
                        console.error('Error checking progress:', error);
                        throw error;
                    }
                } else {
                    console.log('Day 1 progress found:', progress);

                    if (!progress.unlocked_at && !progress.completed) {
                        showDBStatus('‚ùå Day 1 is locked', 'error');
                        setTimeout(() => {
                            window.location.href = 'dashboard.html';
                        }, 1500);
                        return;
                    }

                    if (progress.completed) {
                        console.log('Day 1 is completed - read-only mode');
                        isReadOnly = true;
                    }
                }

                console.log('Access granted! Read-only:', isReadOnly);
                showDBStatus('‚úÖ Access granted!', 'success');

                // Show content
                setTimeout(() => {
                    hideDBStatus();
                    document.getElementById('loadingDay').style.display = 'none';
                    document.getElementById('dayContent').style.display = 'block';
                    initializeQuiz();
                }, 1000);

            } catch (error) {
                console.error('Error initializing day:', error);
                showDBStatus('‚ùå Error: ' + error.message, 'error');
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 2000);
            }
        }

        async function createDayProgress() {
            const {
                error
            } = await supabase
                .from('user_progress')
                .insert([{
                    user_id: currentUser.id,
                    day_number: currentDay,
                    unlocked_at: new Date().toISOString(),
                    next_unlock_at: null,
                    completed: false,
                    progress: 0,
                    score: 0,
                    answers: {}
                }]);

            if (error) throw error;
        }

        function initializeQuiz() {
            console.log('Initializing quiz...');

            // Quiz state - SIMPLIFIED like Day 5
            let currentPuzzle = 1;
            const totalPuzzles = 5;
            const completedPuzzles = new Array(totalPuzzles).fill(false);

            // DOM Elements
            const currentPuzzleSpan = document.getElementById('currentPuzzle');
            const progressFill = document.getElementById('progressFill');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const completeBtn = document.getElementById('completeBtn');
            const dots = document.querySelectorAll('.dot');
            const specialMessage = document.getElementById('specialMessage');
            const messageText = document.getElementById('messageText');
            const messageTitle = document.getElementById('messageTitle');
            const closeMessage = document.getElementById('closeMessage');
            const consecutiveCounter = document.getElementById('consecutiveCounter'); // Will hide in read-only
            const completedMessage = document.getElementById('completedMessage');

            // Set up read-only mode if day is completed - LIKE DAY 5
            if (isReadOnly) {
                setupReadOnlyMode();
            }

            // Function to show specific puzzle
            function showPuzzle(num) {
                console.log('Showing puzzle', num);

                // Hide all puzzles
                for (let i = 1; i <= totalPuzzles; i++) {
                    const puzzle = document.getElementById(`puzzle${i}`);
                    if (puzzle) {
                        puzzle.classList.remove('active');
                    }
                }

                // Show current puzzle
                const currentPuzzleElement = document.getElementById(`puzzle${num}`);
                if (currentPuzzleElement) {
                    currentPuzzleElement.classList.add('active');
                    currentPuzzle = num;
                }

                // Update UI
                updateProgress();
                updateNavigation();
            }

            // Update progress display
            function updateProgress() {
                if (currentPuzzleSpan) currentPuzzleSpan.textContent = currentPuzzle;

                // Calculate progress percentage
                const completedCount = completedPuzzles.filter(c => c).length;
                const progressPercent = ((completedCount + (currentPuzzle - 1)) / totalPuzzles) * 100;
                if (progressFill) progressFill.style.width = `${progressPercent}%`;

                // Update dots
                dots.forEach((dot, index) => {
                    const puzzleNum = index + 1;
                    dot.classList.remove('active', 'completed');

                    if (puzzleNum === currentPuzzle) {
                        dot.classList.add('active');
                    } else if (completedPuzzles[puzzleNum - 1]) {
                        dot.classList.add('completed');
                    }
                });

                // Show/hide complete button
                const allCompleted = completedPuzzles.every(c => c);
                if (completeBtn && !isReadOnly) {
                    if (allCompleted) {
                        completeBtn.style.display = 'block';
                    } else {
                        completeBtn.style.display = 'none';
                    }
                }
            }

            // Update navigation buttons
            function updateNavigation() {
                if (prevBtn) prevBtn.disabled = currentPuzzle === 1;
                if (nextBtn) nextBtn.disabled = currentPuzzle === totalPuzzles;
            }

            // Setup all event listeners
            function setupEventListeners() {
                console.log('Setting up event listeners...');

                // Previous/Next buttons
                if (prevBtn) {
                    prevBtn.addEventListener('click', function() {
                        if (currentPuzzle > 1) {
                            showPuzzle(currentPuzzle - 1);
                        }
                    });
                }

                if (nextBtn) {
                    nextBtn.addEventListener('click', function() {
                        if (currentPuzzle < totalPuzzles) {
                            showPuzzle(currentPuzzle + 1);
                        }
                    });
                }

                // Complete button - HIDE in read-only like Day 5
                if (completeBtn && !isReadOnly) {
                    completeBtn.addEventListener('click', function() {
                        showSpecialMessage("You really want me to marry you ü•π", true);
                    });
                }

                // Close message button
                if (closeMessage) {
                    closeMessage.addEventListener('click', function() {
                        specialMessage.style.display = 'none';

                        // If day is complete, redirect to dashboard
                        if (completedPuzzles.every(c => c) && !isReadOnly) {
                            completeDay();
                        }
                    });
                }

                // Load saved answers first - LIKE DAY 5
                loadSavedAnswers().then(savedAnswers => {
                    console.log('Loaded saved answers:', savedAnswers);
                    if (savedAnswers && savedAnswers.length > 0) {
                        restoreProgress(savedAnswers);
                        // Force update the progress display
                        updateProgress();
                    }

                    // Show puzzle 1 AFTER loading answers - LIKE DAY 5
                    showPuzzle(1);

                    // Now setup each puzzle (only if not read-only) - LIKE DAY 5
                    if (!isReadOnly) {
                        setupMultipleChoice(1);
                        setupMultipleChoice(2);
                        setupMultipleChoice(3);
                        setupDateInput();
                        setupWordScramble();
                    } else {
                        // In read-only mode, we just need to set up navigation
                        // The answers are already restored in restoreProgress()
                    }
                });
            }

            // Setup multiple choice puzzles - SIMPLIFIED like Day 5
            function setupMultipleChoice(puzzleNum) {
                const options = document.querySelectorAll(`#puzzle${puzzleNum} .option`);
                console.log(`Setting up puzzle ${puzzleNum}, found ${options.length} options`);

                options.forEach(option => {
                    option.addEventListener('click', async function() {
                        if (this.disabled) return;

                        const userAnswer = this.dataset.answer;
                        const isCorrect = userAnswer === CORRECT_ANSWERS[puzzleNum];

                        if (isCorrect) {
                            // Correct answer - SIMPLIFIED like Day 5
                            this.classList.add('correct');
                            completedPuzzles[puzzleNum - 1] = true;
                            options.forEach(opt => opt.disabled = true);

                            // Save answer to Supabase
                            await saveAnswerToSupabase(puzzleNum, {
                                answer: userAnswer,
                                correct: true,
                                attempts: 1
                            });

                            // Update progress
                            updateProgress();
                            showFeedback(puzzleNum, true, 1); // Changed to "Good" like Day 5
                        } else {
                            // Wrong answer - SIMPLIFIED like Day 5
                            this.classList.add('wrong');
                            this.disabled = true;

                            // Save attempt to Supabase
                            await saveAnswerToSupabase(puzzleNum, {
                                answer: userAnswer,
                                correct: false,
                                attempts: 1
                            });

                            // Show feedback - SIMPLIFIED like Day 5
                            showFeedback(puzzleNum, false, 1);
                        }
                    });
                });
            }

            // Setup date input puzzle - SIMPLIFIED like Day 5
            function setupDateInput() {
                const dateInput = document.getElementById('dateInput');
                const checkDateBtn = document.getElementById('checkDate');

                if (!dateInput || !checkDateBtn) {
                    console.error('Date input elements not found');
                    return;
                }

                checkDateBtn.addEventListener('click', async function() {
                    const userAnswer = dateInput.value.trim();
                    if (!userAnswer) {
                        showFeedback(4, false, 0);
                        return;
                    }

                    const isCorrect = userAnswer === CORRECT_ANSWERS[4];

                    if (isCorrect) {
                        // Correct answer - SIMPLIFIED like Day 5
                        dateInput.classList.add('correct');
                        dateInput.disabled = true;
                        checkDateBtn.disabled = true;
                        completedPuzzles[3] = true;

                        // Save answer to Supabase
                        await saveAnswerToSupabase(4, {
                            answer: userAnswer,
                            correct: true,
                            attempts: 1
                        });

                        // Update progress
                        updateProgress();
                        showFeedback(4, true, 1); // Changed to "Good" like Day 5
                    } else {
                        // Wrong answer - SIMPLIFIED like Day 5
                        dateInput.classList.add('wrong');

                        // Save attempt to Supabase
                        await saveAnswerToSupabase(4, {
                            answer: userAnswer,
                            correct: false,
                            attempts: 1
                        });

                        // Clear input after delay
                        setTimeout(() => {
                            dateInput.classList.remove('wrong');
                            dateInput.value = '';
                        }, 1000);

                        showFeedback(4, false, 1);
                    }
                });

                // Enter key support
                dateInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkDateBtn.click();
                    }
                });
            }

            // Setup word scramble puzzle - SIMPLIFIED like Day 5
            function setupWordScramble() {
                const letterInputs = document.querySelectorAll('.letter');
                const checkWordBtn = document.getElementById('checkWord');

                if (!letterInputs.length || !checkWordBtn) {
                    console.error('Nope');
                    return;
                }

                checkWordBtn.addEventListener('click', async function() {
                    // Get the word from inputs
                    const word = Array.from(letterInputs).map(input => input.value).join('').toUpperCase();
                    if (word.length !== 5) {
                        showFeedback(5, false, 0);
                        return;
                    }

                    const isCorrect = word === CORRECT_ANSWERS[5];

                    if (isCorrect) {
                        // Correct answer - SIMPLIFIED like Day 5
                        letterInputs.forEach(input => {
                            input.classList.add('correct üòÅ');
                            input.disabled = true;
                        });
                        checkWordBtn.disabled = true;
                        completedPuzzles[4] = true;

                        // Save answer to Supabase
                        await saveAnswerToSupabase(5, {
                            answer: word,
                            correct: true,
                            attempts: 1
                        });

                        // Update progress
                        updateProgress();
                        showFeedback(5, true, 1); // Changed to "Good" like Day 5
                    } else {
                        // Wrong answer - SIMPLIFIED like Day 5
                        letterInputs.forEach(input => input.classList.add('wrong üò≠'));

                        // Save attempt to Supabase
                        await saveAnswerToSupabase(5, {
                            answer: word,
                            correct: false,
                            attempts: 1
                        });

                        // Clear inputs after delay
                        setTimeout(() => {
                            letterInputs.forEach(input => {
                                input.classList.remove('wrong üò≠');
                                input.value = '';
                            });
                            letterInputs[0].focus();
                        }, 1000);

                        showFeedback(5, false, 1);
                    }
                });

                // Enter key support
                letterInputs.forEach(input => {
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            checkWordBtn.click();
                        }
                    });
                });
            }

            // Show feedback message - CHANGED TO MATCH DAY 5
            function showFeedback(puzzleNum, isCorrect, attempt) {
                const feedbackElement = document.getElementById(`feedback${puzzleNum}`);
                if (!feedbackElement) return;

                // In read-only mode, don't show any feedback messages - LIKE DAY 5
                if (isReadOnly) {
                    feedbackElement.style.display = 'none';
                    return;
                }

                if (isCorrect) {
                    // Changed from "Correct! Well done!" to "Good" like Day 5
                    feedbackElement.textContent = "Good";
                    feedbackElement.className = 'feedback correct';
                    feedbackElement.style.display = 'block';

                    // Auto-hide after 2 seconds for active mode - LIKE DAY 5
                    setTimeout(() => {
                        feedbackElement.style.display = 'none';
                    }, 2000);
                } else {
                    // Simplified feedback like Day 5
                    let message;
                    if (attempt === 1) {
                        message = "Nope that's wrong üò≠";
                    } else {
                        message = "Try again! üò¢";
                    }

                    feedbackElement.textContent = message;
                    feedbackElement.className = 'feedback incorrect';
                    feedbackElement.style.display = 'block';

                    // Auto-hide after 3 seconds
                    setTimeout(() => {
                        feedbackElement.style.display = 'none';
                    }, 3000);
                }
            }

            // Show special message popup
            function showSpecialMessage(message, isDayComplete = false) {
                if (!messageText || !messageTitle) return;

                messageText.textContent = message;
                messageTitle.textContent = isDayComplete ? "Day 1 Complete! " : "Special Message! üíï";
                if (specialMessage) {
                    specialMessage.style.display = 'flex';
                }

                // If day is complete, update button text
                if (isDayComplete && closeMessage) {
                    closeMessage.textContent = "Go to Dashboard";
                }
            }

            // REMOVED: Show hint after 2 wrong attempts (not in Day 5 pattern)
            // REMOVED: Update consecutive counter display (not in Day 5 pattern)

            // Save answer to Supabase
            async function saveAnswerToSupabase(puzzleNumber, answerData) {
                try {
                    const {
                        error
                    } = await supabase
                        .from('day_answers')
                        .upsert({
                            user_id: currentUser.id,
                            day_number: currentDay,
                            puzzle_number: puzzleNumber,
                            answer: answerData.answer,
                            correct: answerData.correct,
                            attempts: answerData.attempts,
                            answered_at: new Date().toISOString()
                        }, {
                            onConflict: 'user_id,day_number,puzzle_number'
                        });

                    if (error) throw error;

                    // Update progress in Supabase
                    await updateProgressInSupabase();

                    showSaveStatus('Answer saved!');

                } catch (error) {
                    console.error('Error saving answer:', error);
                    showSaveStatus('Failed to save', 'error');
                }
            }

            // Update progress in Supabase
            async function updateProgressInSupabase() {
                try {
                    // Count completed puzzles
                    const {
                        data: answers,
                        error: answersError
                    } = await supabase
                        .from('day_answers')
                        .select('correct')
                        .eq('user_id', currentUser.id)
                        .eq('day_number', currentDay);

                    if (answersError) throw answersError;

                    const completedCount = answers.filter(a => a.correct).length;
                    const isComplete = completedCount === 5;

                    // Update progress
                    const {
                        error: progressError
                    } = await supabase
                        .from('user_progress')
                        .update({
                            progress: completedCount,
                            completed: isComplete,
                            score: completedCount * 20,
                            completed_at: isComplete ? new Date().toISOString() : null
                        })
                        .eq('user_id', currentUser.id)
                        .eq('day_number', currentDay);

                    if (progressError) throw progressError;

                    if (isComplete && !isReadOnly) {
                        // Start countdown for next day
                        await startNextDayCountdown();
                    }

                } catch (error) {
                    console.error('Error updating progress:', error);
                }
            }

            // Start countdown for next day
            async function startNextDayCountdown() {
                try {
                    const nextDay = currentDay + 1;
                    if (nextDay > 7) return;

                    // 24 hours for Jessica (girlfriend), 3 minutes for Hlakulo (test)
                    const isJessica = currentUser.is_jessica;
                    const unlockDuration = isJessica ? 24 * 60 * 60 * 1000 : 3 * 60 * 1000;
                    const nextUnlockAt = new Date(Date.now() + unlockDuration).toISOString();

                    console.log(`Countdown for Day ${nextDay}: ${isJessica ? '24 hours (Jessica real)' : '3 minutes (Hlakulo test)'}`);

                    // Create or update next day progress
                    const {
                        error
                    } = await supabase
                        .from('user_progress')
                        .upsert({
                            user_id: currentUser.id,
                            day_number: nextDay,
                            next_unlock_at: nextUnlockAt,
                            unlocked_at: null,
                            completed: false,
                            progress: 0,
                            score: 0
                        }, {
                            onConflict: 'user_id,day_number'
                        });

                    if (error) throw error;

                } catch (error) {
                    console.error('Error starting countdown:', error);
                }
            }

            // Load saved answers from Supabase
            async function loadSavedAnswers() {
                try {
                    const {
                        data: answers,
                        error
                    } = await supabase
                        .from('day_answers')
                        .select('*')
                        .eq('user_id', currentUser.id)
                        .eq('day_number', currentDay)
                        .order('puzzle_number', {
                            ascending: true
                        });

                    if (error) throw error;

                    return answers || [];

                } catch (error) {
                    console.error('Error loading saved answers:', error);
                    return [];
                }
            }

            // Restore progress from saved answers - UPDATED TO MATCH DAY 5
            function restoreProgress(savedAnswers) {
                console.log('Restoring progress from:', savedAnswers);

                if (!savedAnswers || savedAnswers.length === 0) {
                    console.log('No saved answers found');
                    return;
                }

                // Mark all puzzles as completed by default in read-only mode
                if (isReadOnly) {
                    for (let i = 0; i < totalPuzzles; i++) {
                        completedPuzzles[i] = true;
                    }
                }

                savedAnswers.forEach(answer => {
                    const puzzleNum = answer.puzzle_number;

                    if (answer.correct) {
                        completedPuzzles[puzzleNum - 1] = true;

                        // Restore multiple choice (Puzzles 1-3)
                        if (puzzleNum <= 3) {
                            const options = document.querySelectorAll(`#puzzle${puzzleNum} .option`);
                            options.forEach(option => {
                                option.disabled = true;
                                if (option.dataset.answer === answer.answer) {
                                    option.classList.add('correct');
                                }
                            });
                        }
                        // Restore date input (Puzzle 4)
                        else if (puzzleNum === 4) {
                            const dateInput = document.getElementById('dateInput');
                            const checkDateBtn = document.getElementById('checkDate');
                            if (dateInput) {
                                dateInput.value = answer.answer;
                                dateInput.classList.add('correct');
                                dateInput.disabled = true;
                            }
                            if (checkDateBtn) checkDateBtn.disabled = true;
                        }
                        // Restore word scramble (Puzzle 5)
                        else if (puzzleNum === 5) {
                            const letterInputs = document.querySelectorAll('.letter');
                            const checkWordBtn = document.getElementById('checkWord');
                            const word = answer.answer || '';
                            for (let i = 0; i < Math.min(word.length, letterInputs.length); i++) {
                                letterInputs[i].value = word[i];
                                letterInputs[i].classList.add('correct üòÅ');
                                letterInputs[i].disabled = true;
                            }
                            if (checkWordBtn) checkWordBtn.disabled = true;
                        }

                        // Don't show feedback in read-only mode - LIKE DAY 5
                        if (!isReadOnly) {
                            const feedbackElement = document.getElementById(`feedback${puzzleNum}`);
                            if (feedbackElement) {
                                feedbackElement.textContent = "Good"; // Changed to match Day 5
                                feedbackElement.className = 'feedback correct';
                                feedbackElement.style.display = 'block';

                                // Hide after 2 seconds in active mode
                                setTimeout(() => {
                                    feedbackElement.style.display = 'none';
                                }, 2000);
                            }
                        }
                    } else {
                        // For wrong answers in read-only mode, still show the attempt
                        if (isReadOnly) {
                            if (puzzleNum <= 3) {
                                const options = document.querySelectorAll(`#puzzle${puzzleNum} .option`);
                                options.forEach(option => {
                                    option.disabled = true;
                                    if (option.dataset.answer === answer.answer) {
                                        option.classList.add('wrong üò≠');
                                    }
                                });
                            }
                        }
                    }
                });

                console.log('Completed puzzles after restore:', completedPuzzles);
            }

            // Complete the day
            async function completeDay() {
                try {
                    // Mark day as complete in Supabase
                    const {
                        error
                    } = await supabase
                        .from('user_progress')
                        .update({
                            completed: true,
                            completed_at: new Date().toISOString()
                        })
                        .eq('user_id', currentUser.id)
                        .eq('day_number', currentDay);

                    if (error) throw error;

                    // Redirect to dashboard after delay
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 500);

                } catch (error) {
                    console.error('Error completing day:', error);
                }
            }

            // Show save status
            function showSaveStatus(message, type = 'success') {
                const status = document.getElementById('saveStatus');
                if (status) {
                    status.textContent = message;
                    status.style.color = type === 'success' ? '#28a745' : '#dc3545';
                    status.style.display = 'block';

                    setTimeout(() => {
                        status.style.display = 'none';
                    }, 3000);
                }
            }

            // Function to set up read-only mode - UPDATED TO MATCH DAY 5
            function setupReadOnlyMode() {
                console.log('Setting up read-only mode...');

                // Update header
                const header = document.querySelector('.header h1');
                if (header) {
                    header.innerHTML = 'Day 1: Completed ‚úÖ <span class="completed-badge">READ ONLY</span>';
                }

                // Update day indicator
                const dayIndicator = document.querySelector('.day-indicator');
                if (dayIndicator) {
                    dayIndicator.textContent = 'Day 1 of 7 (Completed)';
                }

                // Show completed message
                if (completedMessage) {
                    completedMessage.style.display = 'block';
                }

                // Hide complete button - LIKE DAY 5
                if (completeBtn) {
                    completeBtn.style.display = 'none';
                }

                // Hide consecutive counter in read-only mode - LIKE DAY 5
                if (consecutiveCounter) {
                    consecutiveCounter.style.display = 'none';
                }

                // Add read-only class to body
                document.body.classList.add('read-only-mode');

                // Disable all interactive elements except navigation buttons
                const allOptions = document.querySelectorAll('.option');
                allOptions.forEach(option => {
                    option.disabled = true;
                    option.style.cursor = 'default';
                });

                const allInputs = document.querySelectorAll('input, button:not(.back-btn):not(.nav-btn)');
                allInputs.forEach(input => {
                    input.disabled = true;
                });

                // Load and display saved answers immediately - LIKE DAY 5
                loadSavedAnswers().then(savedAnswers => {
                    console.log('Loading answers for read-only mode:', savedAnswers);
                    if (savedAnswers && savedAnswers.length > 0) {
                        restoreProgress(savedAnswers);
                        // Force update the progress display
                        updateProgress();
                    } else {
                        console.log('No saved answers found for read-only mode');
                    }
                });
            }

            // Initialize the quiz
            setupEventListeners();
            // Don't call showPuzzle(1) here - it's called in setupEventListeners() after loading answers
        }

        function showDBStatus(message, type = '') {
            const statusBar = document.getElementById('dbStatus');
            if (statusBar) {
                statusBar.textContent = message;
                statusBar.className = `db-status ${type}`;
                statusBar.style.display = 'block';
            }
        }

        function hideDBStatus() {
            const statusBar = document.getElementById('dbStatus');
            if (statusBar) {
                statusBar.style.display = 'none';
            }
        }
    </script>
</body>

</html>