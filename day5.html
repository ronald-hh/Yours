<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 5: Memories & Meanings</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ffd6e0 0%, #c1f0ff 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 40px 20px;
            overflow-y: auto;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(255, 214, 224, 0.3);
        }
        
        .header {
            background: linear-gradient(135deg, #ffd6e0, #c1f0ff);
            color: white;
            padding: 30px 25px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .progress {
            margin-top: 15px;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .back-btn {
            padding: 10px 20px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .day-indicator {
            font-weight: 600;
            color: #ffd6e0;
            font-size: 1.1rem;
        }
        
        .db-status {
            background: #e3f2fd;
            border: 2px solid #bbdefb;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 25px;
            color: #1565c0;
            font-weight: 600;
            text-align: center;
            display: none;
        }
        
        .db-status.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .db-status.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .progress-bar {
            height: 10px;
            background: #e0e0e0;
            margin-top: 15px;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #ffd6e0, #c1f0ff);
            transition: width 0.5s ease;
        }
        
        .progress-dots {
            display: flex;
            justify-content: space-between;
            margin-top: -15px;
        }
        
        .dot {
            width: 40px;
            height: 40px;
            background: #e0e0e0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #666;
            z-index: 1;
        }
        
        .dot.active {
            background: #ffd6e0;
            color: white;
            transform: scale(1.1);
        }
        
        .dot.completed {
            background: #c1f0ff;
            color: white;
        }
        
        .puzzle-content {
            padding: 40px;
            min-height: 600px;
        }
        
        .puzzle {
            display: none;
            animation: fadeIn 0.5s ease;
            padding: 20px 0;
        }
        
        .puzzle.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .puzzle h2 {
            color: #333;
            font-size: 1.8rem;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        .option {
            padding: 25px 20px;
            background: #f8f9fa;
            border: 3px solid #dee2e6;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
            text-align: center;
        }
        
        .option:hover:not(:disabled) {
            border-color: #ffd6e0;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(255, 214, 224, 0.2);
        }
        
        .option.correct {
            background: #c1f0ff;
            color: white;
            border-color: #ffd6e0;
        }
        
        .option.wrong {
            background: #ffd6e0;
            color: white;
            border-color: #c1f0ff;
        }
        
        .option:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        .text-input {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 40px 0;
        }
        
        .text-input input {
            padding: 20px;
            border: 3px solid #dee2e6;
            border-radius: 12px;
            font-size: 1.3rem;
            width: 300px;
            text-align: center;
        }
        
        .text-input button {
            padding: 20px 40px;
            background: #ffd6e0;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.3rem;
            cursor: pointer;
            font-weight: 600;
        }
        
        .text-input button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .text-area {
            width: 100%;
            max-width: 600px;
            height: 150px;
            padding: 20px;
            border: 3px solid #dee2e6;
            border-radius: 12px;
            font-size: 1.1rem;
            font-family: inherit;
            resize: none;
            margin: 20px auto;
            display: block;
        }
        
        .text-area:focus {
            outline: none;
            border-color: #ffd6e0;
        }
        
        .penguin-message {
            background: #f0f9ff;
            border: 2px solid #c1f0ff;
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
            text-align: center;
            font-style: italic;
            color: #333;
            line-height: 1.6;
            display: none;
        }
        
        .quote-box {
            background: #fff0f5;
            border: 2px solid #ffd6e0;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            text-align: center;
            font-style: italic;
            color: #333;
            line-height: 1.8;
            font-size: 1.1rem;
        }
        
        .number-inputs {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 40px 0;
        }
        
        .number-input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            width: 100%;
            max-width: 400px;
        }
        
        .number-input-group label {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .feedback {
            padding: 20px;
            margin: 25px auto;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: 600;
            text-align: center;
            max-width: 600px;
            display: none;
        }
        
        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 3px solid #c3e6cb;
        }
        
        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 3px solid #f5c6cb;
        }
        
        .special-message {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .message-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: scaleIn 0.3s ease;
        }
        
        @keyframes scaleIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .message-box h3 {
            color: #ffd6e0;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }
        
        .message-box p {
            color: #333;
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .message-box button {
            padding: 15px 40px;
            background: #ffd6e0;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
        }
        
        .hint-box {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            color: #856404;
            font-style: italic;
            text-align: center;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
            padding: 30px 0;
            border-top: 2px solid #e9ecef;
        }
        
        .nav-btn {
            padding: 18px 35px;
            font-size: 1.2rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .prev-btn {
            background: #6c757d;
            color: white;
        }
        
        .next-btn {
            background: #ffd6e0;
            color: white;
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .complete-btn {
            padding: 20px 50px;
            background: #c1f0ff;
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.4rem;
            font-weight: 600;
            cursor: pointer;
            display: none;
            margin: 30px auto;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(193, 240, 255, 0.4);
            }
            50% {
                box-shadow: 0 0 0 20px rgba(193, 240, 255, 0);
            }
        }
        
        .footer {
            text-align: center;
            padding: 25px;
            background: #f8f9fa;
            color: #666;
            border-top: 2px solid #e9ecef;
        }
        
        .hint {
            color: #888;
            font-style: italic;
            text-align: center;
            margin: 15px 0;
            font-size: 1.1rem;
        }
        
        .save-status {
            text-align: center;
            color: #28a745;
            font-weight: 600;
            margin: 20px 0;
            font-size: 1.1rem;
            min-height: 24px;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            flex-direction: column;
            gap: 20px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #fff0f5;
            border-top: 5px solid #ffd6e0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        .read-only-mode .option,
        .read-only-mode input,
        .read-only-mode textarea,
        .read-only-mode button:not(.back-btn):not(.nav-btn):not(.player-btn):not(.play-btn) {
            opacity: 0.8;
            cursor: default !important;
        }
        
        .read-only-mode .option:hover {
            transform: none !important;
            box-shadow: none !important;
            border-color: #dee2e6 !important;
        }
        
        .read-only-mode .container {
            border: 3px solid #c1f0ff;
        }
        
        .completed-badge {
            background: #c1f0ff;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .completed-message {
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
            border: 2px solid #c3e6cb;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            .header {
                padding: 20px 15px;
            }
            .header h1 {
                font-size: 1.8rem;
            }
            .puzzle-content {
                padding: 20px;
            }
            .options {
                grid-template-columns: 1fr;
            }
            .option {
                padding: 20px 15px;
                font-size: 1.1rem;
            }
            .number-inputs {
                padding: 0 10px;
            }
            .navigation {
                flex-direction: column;
                gap: 10px;
            }
            .nav-btn {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Database Status -->
        <div id="dbStatus" class="db-status">üîÑ Checking access...</div>

        <!-- Loading State -->
        <div id="loadingDay" class="loading">
            <div class="spinner"></div>
            <p>Loading Day 5...</p>
        </div>

        <!-- Main Content (hidden initially) -->
        <div id="dayContent" style="display: none;">
            <!-- Header -->
            <div class="header">
                <h1 id="dayTitle">Day 5: Memories & Meanings</h1>
                <div class="progress">Question <span id="currentPuzzle">1</span>/5</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-dots">
                    <div class="dot active">1</div>
                    <div class="dot">2</div>
                    <div class="dot">3</div>
                    <div class="dot">4</div>
                    <div class="dot">5</div>
                </div>
            </div>

            <!-- Navigation Bar -->
            <div class="nav-bar">
                <a href="dashboard.html" class="back-btn">‚Üê Back to Dashboard</a>
                <div id="dayIndicator" class="day-indicator">Day 5 of 7</div>
            </div>

            <!-- Puzzle Content -->
            <div class="puzzle-content">
                <!-- Completed Message (only shown in read-only mode) -->
                <div id="completedMessage" class="completed-message" style="display: none;">
                    You've already completed this day! Viewing in read-only mode. Proud of you! ‚ù§Ô∏èüôÇ‚Äç‚ÜïÔ∏è
                </div>

                <!-- Puzzle 1 -->
                <div id="puzzle1" class="puzzle active">
                    <h2>Multiple Choice Twist üëÄ</h2>
                    <div class="hint-box">
                        üí° Hint: Think about animals that mate for life
                    </div>
                    <h3 style="text-align: center; margin: 30px 0; color: #333;">"If we were animals, I'd be..."</h3>
                    <div class="options">
                        <button class="option" data-answer="Cat">Cat üê±</button>
                        <button class="option" data-answer="Dog">Dog üê∂</button>
                        <button class="option" data-answer="Fox">Fox ü¶ä</button>
                        <button class="option" data-answer="Penguins">Penguins üêß</button>
                    </div>
                    <div id="penguinMessage" class="penguin-message">
                        Don't forget that penguins find each other and be together forever (You and me)! üêß‚ù§Ô∏è
                    </div>
                    <div id="feedback1" class="feedback"></div>
                </div>

                <!-- Puzzle 2 -->
                <div id="puzzle2" class="puzzle">
                    <h2>Multiple Choice + Story Twist üëÄ</h2>
                    <div class="hint-box">
                        üí°Just choose what feels right!
                    </div>
                    <h3 style="text-align: center; margin: 30px 0; color: #333;">"If I could teleport to you, we'd..."</h3>
                    <div class="options">
                        <button class="option" data-answer="Hug">Hug ü§ó</button>
                        <button class="option" data-answer="Crack">SpoonüòÇ</button>
                        <button class="option" data-answer="Laugh">Laugh together üòÑ</button>
                        <button class="option" data-answer="Cook something">Cook something üç≥</button>
                    </div>
                    <p class="hint" style="margin-top: 30px;">Explain why you chose this:</p>
                    <textarea class="text-area" id="teleportReason" placeholder="Explain your choice here... (max 50 words)" maxlength="300"></textarea>
                    <div id="feedback2" class="feedback"></div>
                </div>

                <!-- Puzzle 3 -->
                <div id="puzzle3" class="puzzle">
                    <h2>Song Memory ü§î</h2>
                    <div class="hint-box">
                        üí° Think about songs I've recommended to you
                    </div>
                    <h3 style="text-align: center; margin: 30px 0; color: #333;">What's the song I once referred you to?</h3>
                    <div class="options">
                        <button class="option" data-answer="You rock my world">You rock my world üåü</button>
                        <button class="option" data-answer="Better">Better üí´</button>
                        <button class="option" data-answer="Pure intentions">Pure intentions ‚ú®</button>
                        <button class="option" data-answer="Fairytale">Fairytale üè∞</button>
                    </div>
                    <div id="feedback3" class="feedback"></div>
                </div>

                <!-- Puzzle 4 -->
                <div id="puzzle4" class="puzzle">
                    <h2>Memory Recall ü§î</h2>
                    <div class="hint-box">
                        üí° Remember something I sent you üòÇ
                    </div>
                    <div class="quote-box">
                        "I'll be your man...I know you are choosing to stay by my side right?... Through my lows and my highs, we'll rise together !!"
                    </div>
                    <h3 style="text-align: center; margin: 30px 0; color: #333;">Do you remember where I wrote this? And if you do go there and check what number was that?</h3>

                    <div class="number-inputs">
                        <div class="number-input-group">
                            <label for="messageNumber">Enter the number:</label>
                            <input type="text" id="messageNumber" placeholder="Enter number" maxlength="2">
                        </div>

                        <div class="number-input-group" style="margin-top: 30px;">
                            <label for="numberMeaning">What does that number mean to me?</label>
                            <input type="text" id="numberMeaning" placeholder="Your answer" maxlength="20">
                            <p class="hint" style="margin-top: 5px;">Hint: Happens every year</p>
                        </div>

                        <button id="checkNumber" style="margin-top: 20px;">Check Answers</button>
                    </div>

                    <div id="feedback4" class="feedback"></div>
                </div>

                <!-- Puzzle 5 -->
                <div id="puzzle5" class="puzzle">
                    <h2>Heartfelt Question üíï</h2>
                    <div class="hint-box">
                        üí° Be honest and from the heart
                    </div>
                    <h3 style="text-align: center; margin: 30px 0; color: #333;">What do you love about me?</h3>
                    <textarea class="text-area" id="loveAboutMe" placeholder="Write what you love about me... (max 30 words)" maxlength="200"></textarea>
                    <button id="saveLoveMessage" class="text-input button" style="margin-top: 20px; padding: 15px 30px; background: #ffd6e0;">Save Answer</button>
                    <div id="feedback5" class="feedback"></div>
                </div>

                <!-- Navigation -->
                <div class="navigation">
                    <button id="prevBtn" class="nav-btn prev-btn" disabled>‚Üê Previous</button>
                    <button id="nextBtn" class="nav-btn next-btn">Next Question ‚Üí</button>
                </div>

                <!-- Save Status -->
                <div id="saveStatus" class="save-status"></div>

                <!-- Complete Button -->
                <button id="completeBtn" class="complete-btn">Complete Day 5, You are really rocking üòÇ</button>
            </div>

            <!-- Footer -->
            <div class="footer">
                <p>Made by Hlakulo (Your Entertainer)</p>
            </div>
        </div>
    </div>

    <!-- Special Message Popup -->
    <div id="specialMessage" class="special-message">
        <div class="message-box">
            <h3 id="messageTitle">Special Message! üíï</h3>
            <p id="messageText"></p>
            <button id="closeMessage">Continue</button>
        </div>
    </div>

    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://yqxrsigblsalvhndfvvs.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlxeHJzaWdibHNhbHZobmRmdnZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwNDUwNjQsImV4cCI6MjA4MDYyMTA2NH0.gsj4ya1LMKNtWGdwhaDa91L81AdOc6E1BcBd2gwXcJc';

        // Global variables
        let supabase;
        let currentUser = null;
        let currentDay = 5;
        let isReadOnly = false;

        // Correct answers
        const CORRECT_ANSWERS = {
            1: 'Penguins',
            2: '', // No wrong answer
            3: 'You rock my world',
            4: {
                number: '7',
                meaning: 'birthday'
            },
            5: '' // No wrong answer
        };

        // Main initialization - SESSIONSTORAGE ONLY (like Day 1)
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Day 5: DOM loaded');

            // SIMPLE AUTHENTICATION CHECK - SESSIONSTORAGE ONLY (like Day 1)
            await checkAuthentication();
        });

        // SIMPLIFIED AUTHENTICATION CHECK - SESSIONSTORAGE ONLY (like Day 1)
        async function checkAuthentication() {
            console.log('Checking authentication...');

            // Check sessionStorage ONLY (will auto-clear when tab closes)
            const sessionData = sessionStorage.getItem('currentUser');

            if (sessionData) {
                try {
                    currentUser = JSON.parse(sessionData);
                    console.log('Found user in sessionStorage:', currentUser.username);

                    console.log('Authentication successful! User:', currentUser.username);

                    // Initialize Supabase
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

                    // Now check Day 5 access
                    await initializeDay();

                } catch (error) {
                    console.error('Error parsing sessionStorage:', error);
                    redirectToLogin();
                }
            } else {
                // No user found
                console.log('NO USER FOUND - Redirecting to login');
                redirectToLogin();
            }
        }

        function redirectToLogin() {
            showDBStatus('‚ùå Please login first!', 'error');
            setTimeout(() => {
                // Clear session data
                sessionStorage.clear();
                window.location.href = 'index.html';
            }, 1500);
        }

        async function initializeDay() {
            console.log('Initializing Day 5 for user:', currentUser.username);
            showDBStatus('üîê Checking Day 5 access...');

            try {
                // Check if Day 5 progress exists
                const {
                    data: progress,
                    error
                } = await supabase
                    .from('user_progress')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .eq('day_number', currentDay)
                    .single();

                if (error) {
                    // If no progress found, check if Day 4 is completed
                    if (error.code === 'PGRST116') {
                        console.log('No Day 5 progress found, checking Day 4 completion...');

                        const {
                            data: day4Progress
                        } = await supabase
                            .from('user_progress')
                            .select('completed')
                            .eq('user_id', currentUser.id)
                            .eq('day_number', 4)
                            .single();

                        if (!day4Progress || !day4Progress.completed) {
                            showDBStatus('‚ùå Complete Day 4 first!', 'error');
                            setTimeout(() => {
                                window.location.href = 'dashboard.html';
                            }, 2000);
                            return;
                        }

                        // Create Day 5 progress
                        await createDayProgress();
                    } else {
                        console.error('Error checking progress:', error);
                        throw error;
                    }
                } else {
                    console.log('Day 5 progress found:', progress);

                    if (!progress.unlocked_at && !progress.completed) {
                        showDBStatus('‚ùå Day 5 is locked', 'error');
                        setTimeout(() => {
                            window.location.href = 'dashboard.html';
                        }, 1500);
                        return;
                    }

                    if (progress.completed) {
                        console.log('Day 5 is completed - read-only mode');
                        isReadOnly = true;
                    }
                }

                console.log('Access granted! Read-only:', isReadOnly);
                showDBStatus('‚úÖ Access granted!', 'success');

                // Show content
                setTimeout(() => {
                    hideDBStatus();
                    document.getElementById('loadingDay').style.display = 'none';
                    document.getElementById('dayContent').style.display = 'block';
                    initializeQuiz();
                }, 1000);

            } catch (error) {
                console.error('Error initializing day:', error);
                showDBStatus('‚ùå Error: ' + error.message, 'error');
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 2000);
            }
        }

        async function createDayProgress() {
            const {
                error
            } = await supabase
                .from('user_progress')
                .insert([{
                    user_id: currentUser.id,
                    day_number: currentDay,
                    unlocked_at: new Date().toISOString(),
                    next_unlock_at: null,
                    completed: false,
                    progress: 0,
                    score: 0,
                    answers: {}
                }]);

            if (error) throw error;
        }

        function initializeQuiz() {
            console.log('Initializing Day 5 quiz...');

            // Quiz state (EXACTLY LIKE DAY 1)
            let currentPuzzle = 1;
            const totalPuzzles = 5;
            const completedPuzzles = new Array(totalPuzzles).fill(false);
            let consecutiveCorrect = 0;

            // DOM Elements
            const currentPuzzleSpan = document.getElementById('currentPuzzle');
            const progressFill = document.getElementById('progressFill');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const completeBtn = document.getElementById('completeBtn');
            const dots = document.querySelectorAll('.dot');
            const specialMessage = document.getElementById('specialMessage');
            const messageText = document.getElementById('messageText');
            const messageTitle = document.getElementById('messageTitle');
            const closeMessage = document.getElementById('closeMessage');
            const completedMessage = document.getElementById('completedMessage');

            // Set up read-only mode if day is completed (EXACTLY LIKE DAY 1)
            if (isReadOnly) {
                setupReadOnlyMode();
            }

            // Function to show specific puzzle (EXACTLY LIKE DAY 1)
            function showPuzzle(num) {
                console.log('Showing puzzle', num);

                // Hide all puzzles
                for (let i = 1; i <= totalPuzzles; i++) {
                    const puzzle = document.getElementById(`puzzle${i}`);
                    if (puzzle) {
                        puzzle.classList.remove('active');
                    }
                }

                // Show current puzzle
                const currentPuzzleElement = document.getElementById(`puzzle${num}`);
                if (currentPuzzleElement) {
                    currentPuzzleElement.classList.add('active');
                    currentPuzzle = num;
                }

                // Update UI
                updateProgress();
                updateNavigation();
            }

            // Update progress display (EXACTLY LIKE DAY 1)
            function updateProgress() {
                if (currentPuzzleSpan) currentPuzzleSpan.textContent = currentPuzzle;

                // Calculate progress percentage
                const completedCount = completedPuzzles.filter(c => c).length;
                const progressPercent = ((completedCount + (currentPuzzle - 1)) / totalPuzzles) * 100;
                if (progressFill) progressFill.style.width = `${progressPercent}%`;

                // Update dots
                dots.forEach((dot, index) => {
                    const puzzleNum = index + 1;
                    dot.classList.remove('active', 'completed');

                    if (puzzleNum === currentPuzzle) {
                        dot.classList.add('active');
                    } else if (completedPuzzles[puzzleNum - 1]) {
                        dot.classList.add('completed');
                    }
                });

                // Show/hide complete button
                const allCompleted = completedPuzzles.every(c => c);
                if (completeBtn && !isReadOnly) {
                    if (allCompleted) {
                        completeBtn.style.display = 'block';
                    } else {
                        completeBtn.style.display = 'none';
                    }
                }
            }

            // Update navigation buttons (EXACTLY LIKE DAY 1)
            function updateNavigation() {
                if (prevBtn) prevBtn.disabled = currentPuzzle === 1;
                if (nextBtn) nextBtn.disabled = currentPuzzle === totalPuzzles;
            }

            // Setup all event listeners (EXACTLY LIKE DAY 1)
            function setupEventListeners() {
                console.log('Setting up event listeners...');

                // Previous/Next buttons
                if (prevBtn) {
                    prevBtn.addEventListener('click', function() {
                        if (currentPuzzle > 1) {
                            showPuzzle(currentPuzzle - 1);
                        }
                    });
                }

                if (nextBtn) {
                    nextBtn.addEventListener('click', function() {
                        if (currentPuzzle < totalPuzzles) {
                            showPuzzle(currentPuzzle + 1);
                        }
                    });
                }

                // Complete button (only in active mode)
                if (completeBtn && !isReadOnly) {
                    completeBtn.addEventListener('click', function() {
                        showSpecialMessage("You're making every day special just by being you üíï", true);
                    });
                }

                // Close message button
                if (closeMessage) {
                    closeMessage.addEventListener('click', function() {
                        specialMessage.style.display = 'none';

                        // If day is complete, redirect to dashboard
                        if (completedPuzzles.every(c => c) && !isReadOnly) {
                            completeDay();
                        }
                    });
                }

                // Load saved answers FIRST, then show puzzle 1 (EXACTLY LIKE DAY 1)
                loadSavedAnswers().then(savedAnswers => {
                    console.log('Loaded saved answers:', savedAnswers);
                    if (savedAnswers && savedAnswers.length > 0) {
                        restoreProgress(savedAnswers);
                        // Force update the progress display
                        updateProgress();
                    }

                    // Show puzzle 1 AFTER loading answers (EXACTLY LIKE DAY 1)
                    showPuzzle(1);

                    // Now setup each puzzle (only if not read-only)
                    if (!isReadOnly) {
                        setupPuzzle1();
                        setupPuzzle2();
                        setupPuzzle3();
                        setupPuzzle4();
                        setupPuzzle5();
                    } else {
                        // In read-only mode, we just need to set up navigation
                        // The answers are already restored in restoreProgress()
                    }
                });
            }

            // Setup Puzzle 1 (Animal choice)
            function setupPuzzle1() {
                const options = document.querySelectorAll('#puzzle1 .option');

                if (!options.length) {
                    console.error('Puzzle 1 elements not found');
                    return;
                }

                options.forEach(option => {
                    option.addEventListener('click', async function() {
                        const userAnswer = this.dataset.answer;
                        const isCorrect = userAnswer === CORRECT_ANSWERS[1];

                        if (isCorrect) {
                            // Correct answer
                            this.classList.add('correct');
                            completedPuzzles[0] = true;
                            options.forEach(opt => opt.disabled = true);

                            // Show penguin message
                            const penguinMessage = document.getElementById('penguinMessage');
                            if (penguinMessage) {
                                penguinMessage.style.display = 'block';
                            }

                            // Save answer to Supabase
                            await saveAnswerToSupabase(1, {
                                answer: userAnswer,
                                correct: true,
                                attempts: 1
                            });

                            // Update progress
                            updateProgress();
                            showFeedback(1, true, 1);
                        } else {
                            // Wrong answer
                            this.classList.add('wrong');
                            this.disabled = true;

                            // Save attempt to Supabase
                            await saveAnswerToSupabase(1, {
                                answer: userAnswer,
                                correct: false,
                                attempts: 1
                            });

                            showFeedback(1, false, 1);
                        }
                    });
                });
            }

            // Setup Puzzle 2 (Teleport question)
            function setupPuzzle2() {
                const options = document.querySelectorAll('#puzzle2 .option');
                const teleportReason = document.getElementById('teleportReason');

                if (!options.length) {
                    console.error('Puzzle 2 elements not found');
                    return;
                }

                options.forEach(option => {
                    option.addEventListener('click', async function() {
                        const userAnswer = this.dataset.answer;

                        // Mark as completed (no wrong answer)
                        this.classList.add('correct');
                        completedPuzzles[1] = true;
                        options.forEach(opt => opt.disabled = true);

                        // Save answer to Supabase
                        await saveAnswerToSupabase(2, {
                            answer: userAnswer,
                            correct: true, // Always correct for this question
                            attempts: 1,
                            reason: teleportReason ? teleportReason.value : ''
                        });

                        // Update progress
                        updateProgress();
                        showFeedback(2, true, 1);
                    });
                });

                // Save reason when typing
                if (teleportReason) {
                    teleportReason.addEventListener('input', function() {
                        // Auto-save reason to Supabase
                        saveAnswerReason(2, this.value);
                    });
                }
            }

            // Setup Puzzle 3 (Song memory) - FIXED VERSION
            function setupPuzzle3() {
                const options = document.querySelectorAll('#puzzle3 .option');

                if (!options.length) {
                    console.error('Puzzle 3 elements not found');
                    return;
                }

                options.forEach(option => {
                    option.addEventListener('click', async function() {
                        const userAnswer = this.dataset.answer;
                        console.log('Puzzle 3 answer clicked:', userAnswer, 'Correct answer:', CORRECT_ANSWERS[3]);

                        // FIXED: Use trim() and case-insensitive comparison
                        const isCorrect = userAnswer.trim() === CORRECT_ANSWERS[3];

                        if (isCorrect) {
                            // Correct answer
                            this.classList.add('correct');
                            completedPuzzles[2] = true;
                            options.forEach(opt => opt.disabled = true);

                            // Save answer to Supabase
                            await saveAnswerToSupabase(3, {
                                answer: userAnswer,
                                correct: true,
                                attempts: 1
                            });

                            // Update progress
                            updateProgress();
                            showFeedback(3, true, 1);
                        } else {
                            // Wrong answer
                            this.classList.add('wrong');
                            this.disabled = true;

                            // Save attempt to Supabase
                            await saveAnswerToSupabase(3, {
                                answer: userAnswer,
                                correct: false,
                                attempts: 1
                            });

                            showFeedback(3, false, 1);
                        }
                    });
                });
            }

            // Setup Puzzle 4 (Memory recall) - FIXED VERSION
            function setupPuzzle4() {
                const messageNumber = document.getElementById('messageNumber');
                const numberMeaning = document.getElementById('numberMeaning');
                const checkNumber = document.getElementById('checkNumber');

                if (!messageNumber || !numberMeaning || !checkNumber) {
                    console.error('Puzzle 4 elements not found');
                    return;
                }

                checkNumber.addEventListener('click', async function() {
                    const numberAnswer = messageNumber.value.trim();
                    const meaningAnswer = numberMeaning.value.trim().toLowerCase();

                    if (!numberAnswer || !meaningAnswer) {
                        showFeedback(4, false, 0, "Please enter both answers!");
                        return;
                    }

                    // FIXED: More flexible comparison for the meaning
                    const isNumberCorrect = numberAnswer === CORRECT_ANSWERS[4].number;

                    // FIXED: Check for variations of "birthday"
                    const isMeaningCorrect = meaningAnswer.includes('birthday') ||
                        meaningAnswer.includes('birth day') ||
                        meaningAnswer === 'bd' ||
                        meaningAnswer === 'bday';

                    const isCorrect = isNumberCorrect && isMeaningCorrect;

                    if (isCorrect) {
                        // Correct answer
                        messageNumber.classList.add('correct');
                        numberMeaning.classList.add('correct');
                        messageNumber.disabled = true;
                        numberMeaning.disabled = true;
                        checkNumber.disabled = true;
                        completedPuzzles[3] = true;

                        // Save answer to Supabase
                        await saveAnswerToSupabase(4, {
                            answer: `${numberAnswer} (${meaningAnswer})`,
                            correct: true,
                            attempts: 1
                        });

                        // Update progress
                        updateProgress();
                        showFeedback(4, true, 1);
                    } else {
                        // Wrong answer
                        if (!isNumberCorrect) messageNumber.classList.add('wrong');
                        if (!isMeaningCorrect) numberMeaning.classList.add('wrong');

                        // Save attempt to Supabase
                        await saveAnswerToSupabase(4, {
                            answer: `${numberAnswer} (${meaningAnswer})`,
                            correct: false,
                            attempts: 1
                        });

                        // Clear wrong inputs after delay
                        setTimeout(() => {
                            if (!isNumberCorrect) {
                                messageNumber.classList.remove('wrong');
                                messageNumber.value = '';
                            }
                            if (!isMeaningCorrect) {
                                numberMeaning.classList.remove('wrong');
                                numberMeaning.value = '';
                            }
                        }, 1000);

                        let message = "Nope that's wrong! ü•≤";
                        if (!isNumberCorrect && !isMeaningCorrect) {
                            message = "Both answers are incorrect!";
                        } else if (!isNumberCorrect) {
                            message = "Wrong number!";
                        } else if (!isMeaningCorrect) {
                            message = "Wrong meaning! Hint: It's a special day that happens every year";
                        }

                        showFeedback(4, false, 1, message);
                    }
                });

                // Enter key support
                messageNumber.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        numberMeaning.focus();
                    }
                });

                numberMeaning.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkNumber.click();
                    }
                });
            }

            // Setup Puzzle 5 (Love question)
            function setupPuzzle5() {
                const loveAboutMe = document.getElementById('loveAboutMe');
                const saveLoveMessage = document.getElementById('saveLoveMessage');

                if (!loveAboutMe || !saveLoveMessage) {
                    console.error('Puzzle 5 elements not found');
                    return;
                }

                saveLoveMessage.addEventListener('click', async function() {
                    const userAnswer = loveAboutMe.value.trim();
                    if (!userAnswer) {
                        showFeedback(5, false, 0);
                        return;
                    }

                    // Mark as completed (must have input)
                    loveAboutMe.disabled = true;
                    saveLoveMessage.disabled = true;
                    completedPuzzles[4] = true;

                    // Save answer to Supabase
                    await saveAnswerToSupabase(5, {
                        answer: userAnswer,
                        correct: true, // Always correct for this question
                        attempts: 1
                    });

                    // Update progress
                    updateProgress();
                    showFeedback(5, true, 1);
                });
            }

            // Show feedback message (EXACTLY LIKE DAY 1) - Updated for Puzzle 4
            function showFeedback(puzzleNum, isCorrect, attempt, customMessage = null) {
                const feedbackElement = document.getElementById(`feedback${puzzleNum}`);
                if (!feedbackElement) return;

                if (isCorrect) {
                    feedbackElement.textContent = "Good! üòä";
                    feedbackElement.className = 'feedback correct';
                    feedbackElement.style.display = 'block';

                    // Auto-hide after 2 seconds for active mode
                    if (!isReadOnly) {
                        setTimeout(() => {
                            feedbackElement.style.display = 'none';
                        }, 2000);
                    }
                } else {
                    let message;
                    if (customMessage) {
                        message = customMessage;
                    } else if (attempt === 1) {
                        message = "Nope that's wrong! ü•≤";
                    } else if (attempt === 2) {
                        message = "What? Don't you know me? üò≠";
                    } else {
                        message = "Still wrong? Try harder!";
                    }

                    feedbackElement.textContent = message;
                    feedbackElement.className = 'feedback incorrect';
                    feedbackElement.style.display = 'block';

                    // Auto-hide after 3 seconds
                    setTimeout(() => {
                        feedbackElement.style.display = 'none';
                    }, 3000);
                }
            }

            // Show special message popup
            function showSpecialMessage(message, isDayComplete = false) {
                if (!messageText || !messageTitle) return;

                messageText.textContent = message;
                messageTitle.textContent = isDayComplete ? "Day 5 Complete!" : "Special Message! üíï";
                if (specialMessage) {
                    specialMessage.style.display = 'flex';
                }

                // If day is complete, update button text
                if (isDayComplete && closeMessage) {
                    closeMessage.textContent = "Go to Dashboard";
                }
            }

            // Save answer to Supabase
            async function saveAnswerToSupabase(puzzleNumber, answerData) {
                try {
                    const {
                        error
                    } = await supabase
                        .from('day_answers')
                        .upsert({
                            user_id: currentUser.id,
                            day_number: currentDay,
                            puzzle_number: puzzleNumber,
                            answer: answerData.answer,
                            correct: answerData.correct,
                            attempts: answerData.attempts,
                            reason: answerData.reason || null,
                            answered_at: new Date().toISOString()
                        }, {
                            onConflict: 'user_id,day_number,puzzle_number'
                        });

                    if (error) throw error;

                    // Update progress in Supabase
                    await updateProgressInSupabase();

                    showSaveStatus('‚úÖ Answer saved!');

                } catch (error) {
                    console.error('Error saving answer:', error);
                    showSaveStatus('‚ùå Failed to save', 'error');
                }
            }

            // Save answer reason separately
            async function saveAnswerReason(puzzleNumber, reason) {
                try {
                    const {
                        error
                    } = await supabase
                        .from('day_answers')
                        .update({
                            reason: reason
                        })
                        .eq('user_id', currentUser.id)
                        .eq('day_number', currentDay)
                        .eq('puzzle_number', puzzleNumber);

                    if (error) throw error;
                } catch (error) {
                    console.error('Error saving reason:', error);
                }
            }

            // Update progress in Supabase
            async function updateProgressInSupabase() {
                try {
                    // Count completed puzzles
                    const {
                        data: answers,
                        error: answersError
                    } = await supabase
                        .from('day_answers')
                        .select('correct')
                        .eq('user_id', currentUser.id)
                        .eq('day_number', currentDay);

                    if (answersError) throw answersError;

                    const completedCount = answers.filter(a => a.correct).length;
                    const isComplete = completedCount === 5;

                    // Update progress
                    const {
                        error: progressError
                    } = await supabase
                        .from('user_progress')
                        .update({
                            progress: completedCount,
                            completed: isComplete,
                            score: completedCount * 20,
                            completed_at: isComplete ? new Date().toISOString() : null
                        })
                        .eq('user_id', currentUser.id)
                        .eq('day_number', currentDay);

                    if (progressError) throw progressError;

                    if (isComplete && !isReadOnly) {
                        // Start countdown for next day
                        await startNextDayCountdown();
                    }

                } catch (error) {
                    console.error('Error updating progress:', error);
                }
            }

            // Load saved answers from Supabase (EXACTLY LIKE DAY 1)
            async function loadSavedAnswers() {
                try {
                    const {
                        data: answers,
                        error
                    } = await supabase
                        .from('day_answers')
                        .select('*')
                        .eq('user_id', currentUser.id)
                        .eq('day_number', currentDay)
                        .order('puzzle_number', {
                            ascending: true
                        });

                    if (error) throw error;

                    return answers || [];

                } catch (error) {
                    console.error('Error loading saved answers:', error);
                    return [];
                }
            }

            // Restore progress from saved answers (EXACTLY LIKE DAY 1) - UPDATED FOR PUZZLES 3 & 4
            function restoreProgress(savedAnswers) {
                console.log('Restoring progress from:', savedAnswers);

                if (!savedAnswers || savedAnswers.length === 0) {
                    console.log('No saved answers found');
                    return;
                }

                // Mark all puzzles as completed by default in read-only mode
                if (isReadOnly) {
                    for (let i = 0; i < totalPuzzles; i++) {
                        completedPuzzles[i] = true;
                    }
                }

                savedAnswers.forEach(answer => {
                    const puzzleNum = answer.puzzle_number;

                    if (answer.correct) {
                        completedPuzzles[puzzleNum - 1] = true;

                        // Restore puzzle 1 (animal choice)
                        if (puzzleNum === 1) {
                            const options = document.querySelectorAll('#puzzle1 .option');
                            const penguinMessage = document.getElementById('penguinMessage');
                            options.forEach(option => {
                                option.disabled = true;
                                if (option.dataset.answer === answer.answer) {
                                    option.classList.add('correct');
                                }
                            });
                            if (penguinMessage) penguinMessage.style.display = 'block';
                        }
                        // Restore puzzle 2 (teleport question)
                        else if (puzzleNum === 2) {
                            const options = document.querySelectorAll('#puzzle2 .option');
                            const teleportReason = document.getElementById('teleportReason');
                            options.forEach(option => {
                                option.disabled = true;
                                if (option.dataset.answer === answer.answer) {
                                    option.classList.add('correct');
                                }
                            });
                            if (teleportReason && answer.reason) {
                                teleportReason.value = answer.reason;
                                teleportReason.disabled = true;
                            }
                        }
                        // Restore puzzle 3 (song memory)
                        else if (puzzleNum === 3) {
                            const options = document.querySelectorAll('#puzzle3 .option');
                            options.forEach(option => {
                                option.disabled = true;
                                if (option.dataset.answer === answer.answer) {
                                    option.classList.add('correct');
                                }
                            });
                        }
                        // Restore puzzle 4 (memory recall)
                        else if (puzzleNum === 4) {
                            const messageNumber = document.getElementById('messageNumber');
                            const numberMeaning = document.getElementById('numberMeaning');
                            const checkNumber = document.getElementById('checkNumber');

                            // Parse the answer which should be in format "7 (birthday)"
                            const answerText = answer.answer || '';
                            const match = answerText.match(/(\d+)\s*\((.*?)\)/);

                            if (match) {
                                if (messageNumber) {
                                    messageNumber.value = match[1];
                                    messageNumber.classList.add('correct');
                                    messageNumber.disabled = true;
                                }
                                if (numberMeaning) {
                                    numberMeaning.value = match[2];
                                    numberMeaning.classList.add('correct');
                                    numberMeaning.disabled = true;
                                }
                            }
                            if (checkNumber) checkNumber.disabled = true;
                        }
                        // Restore puzzle 5 (love question)
                        else if (puzzleNum === 5) {
                            const loveAboutMe = document.getElementById('loveAboutMe');
                            const saveLoveMessage = document.getElementById('saveLoveMessage');
                            if (loveAboutMe) {
                                loveAboutMe.value = answer.answer;
                                loveAboutMe.disabled = true;
                            }
                            if (saveLoveMessage) saveLoveMessage.disabled = true;
                        }
                    } else {
                        // For wrong answers in read-only mode, still show the attempt (EXACTLY LIKE DAY 1)
                        if (isReadOnly) {
                            if (puzzleNum === 1) {
                                const options = document.querySelectorAll('#puzzle1 .option');
                                options.forEach(option => {
                                    option.disabled = true;
                                    if (option.dataset.answer === answer.answer) {
                                        option.classList.add('wrong');
                                    }
                                });
                            } else if (puzzleNum === 3) {
                                const options = document.querySelectorAll('#puzzle3 .option');
                                options.forEach(option => {
                                    option.disabled = true;
                                    if (option.dataset.answer === answer.answer) {
                                        option.classList.add('wrong');
                                    }
                                });
                            }
                        }
                    }
                });

                console.log('Completed puzzles after restore:', completedPuzzles);
            }

            // Complete the day
            async function completeDay() {
                try {
                    // Mark day as complete in Supabase
                    const {
                        error
                    } = await supabase
                        .from('user_progress')
                        .update({
                            completed: true,
                            completed_at: new Date().toISOString()
                        })
                        .eq('user_id', currentUser.id)
                        .eq('day_number', currentDay);

                    if (error) throw error;

                    // Redirect to dashboard after delay
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 500);

                } catch (error) {
                    console.error('Error completing day:', error);
                }
            }

            // Start countdown for next day
            async function startNextDayCountdown() {
                try {
                    const nextDay = currentDay + 1;
                    if (nextDay > 7) return;

                    // 24 hours for Jessica (girlfriend), 3 minutes for Hlakulo (test)
                    const isJessica = currentUser.is_jessica;
                    const unlockDuration = isJessica ? 24 * 60 * 60 * 1000 : 3 * 60 * 1000;
                    const nextUnlockAt = new Date(Date.now() + unlockDuration).toISOString();

                    console.log(`Countdown for Day ${nextDay}: ${isJessica ? '24 hours (Jessica real)' : '3 minutes (Hlakulo test)'}`);

                    // Create or update next day progress
                    const {
                        error
                    } = await supabase
                        .from('user_progress')
                        .upsert({
                            user_id: currentUser.id,
                            day_number: nextDay,
                            next_unlock_at: nextUnlockAt,
                            unlocked_at: null,
                            completed: false,
                            progress: 0,
                            score: 0
                        }, {
                            onConflict: 'user_id,day_number'
                        });

                    if (error) throw error;

                } catch (error) {
                    console.error('Error starting countdown:', error);
                }
            }

            // Show save status
            function showSaveStatus(message, type = 'success') {
                const status = document.getElementById('saveStatus');
                if (status) {
                    status.textContent = message;
                    status.style.color = type === 'success' ? '#28a745' : '#dc3545';
                    status.style.display = 'block';

                    setTimeout(() => {
                        status.style.display = 'none';
                    }, 3000);
                }
            }

            // Function to set up read-only mode (EXACTLY LIKE DAY 1)
            function setupReadOnlyMode() {
                console.log('Setting up read-only mode...');

                // Update header
                const dayTitle = document.getElementById('dayTitle');
                if (dayTitle) {
                    dayTitle.innerHTML = 'Day 5: Completed ‚úÖ <span class="completed-badge">READ ONLY</span>';
                }

                // Update day indicator
                const dayIndicator = document.getElementById('dayIndicator');
                if (dayIndicator) {
                    dayIndicator.textContent = 'Day 5 of 7 (Completed)';
                }

                // Show completed message
                if (completedMessage) {
                    completedMessage.style.display = 'block';
                }

                // Hide complete button
                if (completeBtn) {
                    completeBtn.style.display = 'none';
                }

                // Add read-only class to body
                document.body.classList.add('read-only-mode');

                // Disable all interactive elements except navigation buttons
                const allOptions = document.querySelectorAll('.option');
                allOptions.forEach(option => {
                    option.disabled = true;
                    option.style.cursor = 'default';
                });

                const allInputs = document.querySelectorAll('input, button:not(.back-btn):not(.nav-btn)');
                allInputs.forEach(input => {
                    input.disabled = true;
                });

                // Load and display saved answers immediately (EXACTLY LIKE DAY 1)
                loadSavedAnswers().then(savedAnswers => {
                    console.log('Loading answers for read-only mode:', savedAnswers);
                    if (savedAnswers && savedAnswers.length > 0) {
                        restoreProgress(savedAnswers);
                        // Force update the progress display
                        updateProgress();
                    } else {
                        console.log('No saved answers found for read-only mode');
                    }
                });
            }

            // Initialize the quiz (EXACTLY LIKE DAY 1)
            setupEventListeners();
            // Don't call showPuzzle(1) here - it's called in setupEventListeners() after loading answers
        }

        function showDBStatus(message, type = '') {
            const statusBar = document.getElementById('dbStatus');
            if (statusBar) {
                statusBar.textContent = message;
                statusBar.className = `db-status ${type}`;
                statusBar.style.display = 'block';
            }
        }

        function hideDBStatus() {
            const statusBar = document.getElementById('dbStatus');
            if (statusBar) {
                statusBar.style.display = 'none';
            }
        }
    </script>
</body>

</html>